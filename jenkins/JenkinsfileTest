pipeline {

    agent any

    environment {
        def prename = null
        def lastname = null
    }
    
    stages {
        stage('Assign variables') {
            steps {
                script {
                    
                    def valuesFromFile = readFile 'C:/Users/FlorianEg/OneDrive - MaibornWolff GmbH/Desktop/values.txt'
                    def lines = valuesFromFile.split('\n')
                    def keyValueMap = [:]
        
                    lines.each { line ->
                        def keyValue = line.split(':')
                        if(keyValue.size() == 2){
                            def key = keyValue[0].trim()
                            def value = keyValue[1].trim()
                            keyValue[key] = value
                        }
                    }
        
                    env.prename = keyValueMap.prename
                    env.lastname = keyValueMap.lastname
                }
            }
        }
        stage('Build') {
            steps {
                sh 'mvn -B -DskipTests clean package'
            }
        }
        stage('Test') {
            steps {
                sh 'mvn test'
            }
        }
        stage('Deliver') {
            steps {
                sh './jenkins/scripts/deliver.sh'
            }
        }
        stage('Inform') {
            steps {
                echo 'Pipeline build for ${prename} ${lastname}!'
            }
        }
    }
}
